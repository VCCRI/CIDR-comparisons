setwd("/Users/paullin/Dropbox/CIDR_paper/CIDR-comparisons/Mouse_Brain")
library(NbClust)
library(cidr)
library(tsne)
load("Data/brain_mouse.RData")
info <- read.csv("Data/expression_mRNA_17-Aug-2014.txt", sep="\t")
info <- info[1:9,]
rownames(info) <- info$tissue
info <- info[, -c(1:2)]
ct <- lapply(info[8,], FUN="as.character")
cts <- rep(NA, length(ct))
for(i in 1:length(ct)){
cts[i] <- ct[[i]]
}
id <- lapply(info[7,], FUN="as.character")
ids <- rep(NA, length(id))
for (i in 1:length(id)){
ids[i] <- id[[i]]
}
cell_types <-cts[match(colnames(brain_mouse),ids)]
cell_types <- factor(cell_types)
types <- levels(cell_types)
col_2 <- rgb(0/255,73/255,73/255,1)
col_4 <- rgb(255/255,109/255,182/255,1)
col_6 <- rgb(73/255,0/255,146/255,1)
col_7 <- rgb(0/255,109/255,219/255,1)
col_8 <- rgb(182/255,109/255,255/255,1)
col_10 <- rgb(109/255,219/255,255/255,1)
col_11 <- rgb(146/255,0/255,0/255,1)
col_12 <- rgb(146/255,73/255,0/255,1)
col_13 <- rgb(219/255,209/255,0/255,1)
col_14 <- rgb(36/255,255/255,36/255,1)
col_15 <- rgb(255/255,255/255,109/255,1)
scols <- c(col_2, col_4, col_6, col_7, col_8, col_10, col_11)
adj_rand_ind_col <- "#e0e0e0" # light grey
cols <- rep(NA,length(cell_types))
for (i in 1:length(cols)){
cols[i] <- scols[which(types==cell_types[i])]
}
brain <- brain_mouse[rowSums(brain_mouse)>0,]
priorTPM <- 1
brain_lcpm <- log2(t(t(brain)/colSums(brain))*1000000+priorTPM)
brain10 <- brain[rowSums(brain)>10,]
brain10_lcpm <- log2(t(t(brain10)/colSums(brain10))*1000000+priorTPM)
start <- Sys.time()
scBrain <- scDataConstructor(as.matrix(brain))
scBrain <- determineDropoutCandidates(scBrain)
scBrain <- wThreshold(scBrain)
scBrain <- scDissim(scBrain)
scBrain <- scPCA(scBrain)
scBrain <- nPC(scBrain)
scBrain<- scCluster(scBrain)
Sys.time() - start
## Time difference of 57.94945 secs
plot(scBrain@PC[,c(1,2)],pch=scBrain@clusters,main="CIDR",xlab="PC1", ylab="PC2",col=cols)
nCluster(scBrain)
ARI_cidr <- adjustedRandIndex(scBrain@clusters, cell_types)
ARI_cidr
clusters_cidr <- scBrain@clusters
start <- Sys.time()
scBrain_F <- scDataConstructor(as.matrix(brain))
scBrain_F <- determineDropoutCandidates(scBrain_F)
scBrain_F <- wThreshold(scBrain_F)
scBrain_F <- scDissim(scBrain_F, useStepFunction=FALSE)
scBrain_F <- scPCA(scBrain_F)
scBrain_F <- nPC(scBrain_F)
scBrain_F <- scCluster(scBrain_F)
Sys.time() - start
## Time difference of 1.053636 mins
plot(scBrain_F@PC[,c(1,2)],pch=scBrain_F@clusters,main="CIDR",xlab="PC1", ylab="PC2",col=cols)
#
nCluster(scBrain_F)
ARI_cidr_F <- adjustedRandIndex(scBrain_F@clusters, cell_types)
ARI_cidr_F
start <- Sys.time()
pca <- prcomp(t(brain10_lcpm))
variation <- summary(pca)[[6]][2,]
nPCs <- calc_npc(variation)
CH_prcomp <- NbClust(pca$x[,c(1:nPCs)], method="ward.D2", index="ch", min.nc=1, max.nc=nPCs*3+3)$All.index
l <- length(CH_prcomp)
a <- as.vector(CH_prcomp[-c(1,l-1,l)]+CH_prcomp[-c(1:3)] - 2*CH_prcomp[-c(1,2,l)])
b <- which.min(a)
c <- which.min(a[-c(1:b)])
if ((3*a[b+c])<a[b]){
con_prcomp <- b+c+2
} else {
con_prcomp <- b+2
}
clusters_prcomp <- NbClust(pca$x[,c(1:nPCs)], method="ward.D2", index="ch", min.nc=con_prcomp, max.nc = con_prcomp)$Best.partition
Sys.time()-start
## Time difference of 3.214987 mins
ARI_prcomp <- adjustedRandIndex(clusters_prcomp, cell_types)
ARI_prcomp
load("Results/y_tsne.RData")
CH_tsne <- NbClust(y_tsne[,c(1:nPCs)], method="ward.D2", index="ch", min.nc=1, max.nc=nPCs*3+3)$All.index
l <- length(CH_tsne)
a <- as.vector(CH_tsne[-c(1,l-1,l)]+CH_tsne[-c(1:3)] - 2*CH_tsne[-c(1,2,l)])
b <- which.min(a)
c <- which.min(a[-c(1:b)])
if ((3*a[b+c])<a[b]){
con_tsne <- b+c+2
} else {
con_tsne <- b+2
}
clusters_tsne<- NbClust(y_tsne[,c(1:nPCs)], method="ward.D2", index="ch", min.nc=con_tsne, max.nc = con_tsne)$Best.partition
Sys.time()-start
## Time difference of 23.07392 mins
plot(y_tsne[,c(1,2)],pch=clusters_tsne,main="t-SNE",xlab="PC1", ylab="PC2",col=cols)
ARI_tsne <- adjustedRandIndex(clusters_tsne, cell_types)
ARI_tsne
Z4 <- read.csv(file="Results/Z4.csv", header = FALSE)
CH_zifa <- NbClust(Z4[,c(1:nPCs)], method="ward.D2", index="ch", min.nc=1, max.nc =nPCs*3+3)$All.index
l <- length(CH_zifa)
a <- as.vector(CH_zifa[-c(1,l-1,l)]+CH_zifa[-c(1:3)] - 2*CH_zifa[-c(1,2,l)])
b <- which.min(a)
c <- which.min(a[-c(1:b)])
if ((3*a[b+c])<a[b]){
con_zifa <- b+c+2
} else {
con_zifa <- b+2
}
clusters_zifa<- NbClust(Z4[,c(1:nPCs)], method="ward.D2", index="ch", min.nc=con_zifa, max.nc = con_zifa)$Best.partition
plot(Z4[,c(1,2)],pch=clusters_zifa,main="ZIFA",xlab="PC1", ylab="PC2", col=cols)
ARI_zifa <- adjustedRandIndex(clusters_zifa,cell_types)
ARI_zifa
load("Results/clusters_raceid.RData")
plot(y_tsne[,c(1,2)],pch=clusters_raceid,main="RaceID",xlab="PC1",ylab="PC2", col=cols)
ARI_raceid <- adjustedRandIndex(clusters_raceid,cell_types)
ARI_raceid
barplot(c(ARI_prcomp,ARI_tsne,ARI_zifa,ARI_raceid,ARI_cidr),col="BLUE",
names=c("prcomp", "t-SNE","ZIFA","RaceID","CIDR"),
main = "Adjusted Rand Index",ylim=c(0,1))
setwd("/Users/paullin/Dropbox/CIDR_paper/CIDR-comparisons/Mouse_Brain")
## Install packages NbClust, cidr, tsne.
library(NbClust)
library(cidr)
library(tsne)
## Read in data
load("Data/brain_mouse.RData")
info <- read.csv("Data/expression_mRNA_17-Aug-2014.txt", sep="\t")
info <- info[1:9,]
head(info)
save(info, file="Data/info.RData")
## Make the folder brain_mouse the working directory.
## Install packages NbClust, cidr, tsne.
library(NbClust)
library(cidr)
library(tsne)
## Read in data
load("Data/brain_mouse.RData")
load("Data/info.RData")
rownames(info) <- info$tissue
info <- info[, -c(1:2)]
ct <- lapply(info[8,], FUN="as.character")
cts <- rep(NA, length(ct))
for(i in 1:length(ct)){
cts[i] <- ct[[i]]
}
id <- lapply(info[7,], FUN="as.character")
ids <- rep(NA, length(id))
for (i in 1:length(id)){
ids[i] <- id[[i]]
}
cell_types <-cts[match(colnames(brain_mouse),ids)]
cell_types <- factor(cell_types)
types <- levels(cell_types)
# colors
col_2 <- rgb(0/255,73/255,73/255,1)
col_4 <- rgb(255/255,109/255,182/255,1)
col_6 <- rgb(73/255,0/255,146/255,1)
col_7 <- rgb(0/255,109/255,219/255,1)
col_8 <- rgb(182/255,109/255,255/255,1)
col_10 <- rgb(109/255,219/255,255/255,1)
col_11 <- rgb(146/255,0/255,0/255,1)
col_12 <- rgb(146/255,73/255,0/255,1)
col_13 <- rgb(219/255,209/255,0/255,1)
col_14 <- rgb(36/255,255/255,36/255,1)
col_15 <- rgb(255/255,255/255,109/255,1)
scols <- c(col_2, col_4, col_6, col_7, col_8, col_10, col_11)
adj_rand_ind_col <- "#e0e0e0" # light grey
cols <- rep(NA,length(cell_types))
for (i in 1:length(cols)){
cols[i] <- scols[which(types==cell_types[i])]
}
## simple pre-processing
brain <- brain_mouse[rowSums(brain_mouse)>0,]
priorTPM <- 1
brain_lcpm <- log2(t(t(brain)/colSums(brain))*1000000+priorTPM)
brain10 <- brain[rowSums(brain)>10,]
brain10_lcpm <- log2(t(t(brain10)/colSums(brain10))*1000000+priorTPM)
start <- Sys.time()
scBrain <- scDataConstructor(as.matrix(brain))
scBrain <- determineDropoutCandidates(scBrain)
scBrain <- wThreshold(scBrain)
scBrain <- scDissim(scBrain)
scBrain <- scPCA(scBrain)
scBrain <- nPC(scBrain)
scBrain<- scCluster(scBrain)
Sys.time() - start
## Time difference of 57.94945 secs
plot(scBrain@PC[,c(1,2)],pch=scBrain@clusters,main="CIDR",xlab="PC1", ylab="PC2",col=cols)
nCluster(scBrain)
ARI_cidr <- adjustedRandIndex(scBrain@clusters, cell_types)
ARI_cidr
# 0.5226713
clusters_cidr <- scBrain@clusters
